/* Функция strtok в C разбирает строку на токены (подстроки)
 * по заданным разделителям, модифицируя исходную строку — она заменяет
 * разделители нулевыми символами \0, а для продолжения ищет токены
 * в уже измененной строке, используя указатель, возвращаемый
 * предыдущим вызовом. Пример реализации включает цикл, который
 * находит первый символ токена, затем ищет разделитель, заменяет
 * его \0, возвращает указатель на начало токена, а следующий
 * вызов strtok(NULL, delimiters) продолжит с того места, где
 * остановился предыдущий, пока не вернет NULL, когда строка закончится */

#include <stdio.h>
#include <string.h> // Для strlen, strpbrk

// Простая имитация strtok
char *my_strtok(char *str, const char *delimiters) {
    static char *save_ptr; // Статический указатель для сохранения позиции

    // Если первый вызов или str == NULL, начинаем с начала (или с сохраненной позиции)
    if (str != NULL) {
        save_ptr = str;
    }

    // 1. Пропускаем начальные разделители
    while (*save_ptr != '\0' && strchr(delimiters, *save_ptr) != NULL) {
        save_ptr++;
    }

    // Если достигли конца строки после пропуска разделителей
    if (*save_ptr == '\0') {
        return NULL;
    }

    // 2. Находим конец текущего токена (первый разделитель или \0)
    char *token_start = save_ptr;
    while (*save_ptr != '\0' && strchr(delimiters, *save_ptr) == NULL) {
        save_ptr++;
    }

    // 3. Если нашли разделитель, заменяем его на \0
    if (*save_ptr != '\0') {
        *save_ptr = '\0';
        save_ptr++; // Передвигаем указатель за разделитель для следующего вызова
    }

    return token_start; // Возвращаем начало токена
}

int main() {
    char str[] = "Это,пример,строки,для,strtok";
    const char *delimiters = ",";
    char *token;

    printf("Оригинальная строка: \"%s\"\n", str);

    // Первый вызов
    token = my_strtok(str, delimiters);
    while (token != NULL) {
        printf("Токен: \"%s\"\n", token);
        // Следующие вызовы с NULL, чтобы продолжить с того же места
        token = my_strtok(NULL, delimiters);
    }

    printf("Строка после strtok: \"%s\" (обратите внимание, что она изменена!)\n", str);
    return 0;
}
